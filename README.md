# LibRawFX
Integration of LibRaw (https://www.libraw.org) library for JavaFX for all major operating systems (Linux, Windows, OSX). 
All raw formats can be loaded with the Image class and manipulated by Pixelwriter/Pixelreader. Limitation is that the image class only supports 8-bit color deph but converts all 16bit image format to 8bit automatically.

**JDK 16 is required** because of the foreign linker API usage

## Status
Now the lib is in production ready status. That means it is tested on all operating systems (OSX, Linux, Win10) and under different threading scenarious.

Supported OS:
- Linux
- OSX up to 10.15 (actually no M1 build)
- Windows 10

I have integrated LibRaw version 0.20.2 (https://www.libraw.org/download#changelog)

Actually only the following raw formats are enabled (see class `RAWDescriptor.java`):
- Adobe DNG
- Nikon NEF
- Canon CRW/CR2
- SIMGA Merrill/Quattro X3F
- Fuji X-Trans RAF
- Sony
- Leica

The lib is using allot of memory (always double the memory of the image) because I can only load the complete raw file or decrease it in size about 50%. That means the size
requested by Javafx is actually ignored. Ignored means if requested size is below 300px than the file is loaded with 50% in size otherwise the full image is loaded

## Open topics
- Resize the image after demosaic process to safe processing memory
- Progress support is not precise (the last 5% of the progress bar is duing the demosaic process)

## Usage
Point to the maven coordinates:

```
<dependency>  
    <groupId>org.librawfx</groupId>    
    <artifactId>LibRawFX</artifactId>  
    <version>1.1</version>  
</dependency>  
```  

- In the Class where the start method is add as one of the first lines the following code to install the file handler:

     `RAWImageLoaderFactory.install();`  

- and add the following lines to your java config:
```
--add-modules jdk.incubator.foreign -Dforeign.restricted=permit  
--add-exports=javafx.graphics/com.sun.javafx.iio=org.librawfx 
--add-exports=javafx.graphics/com.sun.javafx.iio.common=org.librawfx
```

- **Module name: org.librawfx**

You can have a look into the class TestAPP.java to see how to use it, but generally just create an Image with the URL/stream and add it to the image view:

```
  Image img=new Image(initialFile.toURI().toURL().toString(), false);  
  ImageView view = new ImageView();  
  view.setFitHeight(200);  
  view.setFitWidth(200);  
  view.setPreserveRatio(true);  
  stack.getChildren().add(view);  
  view.setImage(img);
```  

You can also use the lib without adding the file handler. What I mean is that you can also forget the "...install" line and just load a file URL with the lib (see the `TestApp.java` to see how it works).

## Steps to create your own build:
- OpenJDKA/Adoptopenjdk 16 or newer
- JavaFX 11 or newer (15 is recommended)
- SET JAVA_HOME variable
- Execute `mvn clean compile package -f LibRawFX/pom.xml`
- To run the example execute `mvn javafx:run@cli-default`
- IDE Integration: execute as a maven goal `javafx:run@ide-debug` or `javafx:run@ide-profile`

# Notes:
- The lib is using unoffical JavaFX interfaces
- The lib is using heavily the foreign memory API from Java 16/17 including functions from the project Panama and therefore the tool `JExtract` (Available only in JDK 17)
- All classes inside of package `org.libraw.win` / `org.libraw.linuxosx` are generated by jextract but tuned for operating system specifica
- Inside of these packages above I exposed also the raw interface to libraw
- The main class to interact with the native lib is the class `LibrawImage.java` in package `org.librawfx`
- The lib is only tested actually on OSX 10.15 and Ubuntu 20.04.
     
