# LibRawFX
Integration of LibRaw (https://www.libraw.org) library for JavaFX for all major operating systems (Linux, Windows, OSX). 
All raw formats can be loaded with the Image class and manipulated by Pixelwriter/Pixelreader. Limitation is that the image class only supports 8-bit color deph but converts all 16bit image format to 8bit automatically.

**JDK 16 is required** because of the foreign linker API usage

## Status
Generally the lib should work but I am not sure if all dependency's (native ones) are already in the jar file. Let me know if it is not working and I will add the libs accordingly. 

I have integrated LibRaw version 0.20.2 (https://www.libraw.org/download#changelog)

Actually only the following raw formats are enabled (see class `RAWDescriptor.java`):
- Adobe DNG
- Nikon NEF
- Canon CRW/CR2
- SIMGA Merrill/Quattro X3F
- Fuji X-Trans RAF

The lib is using allot of memory (always double the memory of the image) because I can only load the complete raw file or decrease it in size about 50%. That means the size
requested by Javafx is actually ignored. Ignored means if requested size is below 300px than the file is loaded with 50% in size otherwise the full image is loaded

## Open topics
- It is not possible to influence the demosaic process or access the raw data
- The white balance is set to camera white balance and not exposed to be set
- The output is set to 16bit RGB color model
- Enable more raw formats (registering in `RAWDescriptor.java`) which the lib already supports

## Usage
Point to the maven coordinates:

```
<dependency>  
    <groupId>org.librawfx</groupId>    
    <artifactId>LibRawFX</artifactId>  
    <version>1.0</version>  
</dependency>  
```  

- In the Class where the start method is add as one of the first lines the following code to install the file handler:

     `RAWImageLoaderFactory.install();`  

- and add the following lines to your java config:
```
--add-modules jdk.incubator.foreign -Dforeign.restricted=permit  
--add-exports=javafx.graphics/com.sun.javafx.iio=org.librawfx 
--add-exports=javafx.graphics/com.sun.javafx.iio.common=org.librawfx
```

- **Module name: org.librawfx**


You can have a look into the class TestAPP.java to see how to use it, but generally just create an Image with the URL/stream and add it to the image view:

```
  Image img=new Image(initialFile.toURI().toURL().toString(), false);  
  ImageView view = new ImageView();  
  view.setFitHeight(200);  
  view.setFitWidth(200);  
  view.setPreserveRatio(true);  
  stack.getChildren().add(view);  
  view.setImage(img);
```  

You can also use the lib without adding the file handler. What I mean is that you can also forget the "...install" line and just load a file URL with the lib (see the `TestApp.java` to see how it works).

## Steps to create your own build:
- OpenJDKA/Adoptopenjdk 16 or newer
- JavaFX 11 or newer (15 is recommended)
- SET JAVA_HOME variable
- Execute `mvn clean compile package -f PhotoSlide/pom.xml`
- To run the example execute `mvn javafx:run@cli-default`
- IDE Integration: execute as a maven goal `javafx:run@ide-debug` or `javafx:run@ide-profile`

# Notes:
- The lib is using unoffical JavaFX interfaces
- The lib is using heavily the memory API from Java 16/17 including functions from the project Panama and therefore the tool `JExtract` (Available only in JDK 17)
- All classes inside of package `org.libraw` are generated by jextract
- The main class to interact with the native lib is the class `LibrawImage.java` in package `org.librawfx`
- All functions inside `LibrawImage.java` is low level java code and therefore it is not tested if it performs well with thousands of images.
- The lib is only tested actually on OSX 10.15. Feel free to give me Feedback if it works under Windows and Linux (it should normally do)
     
